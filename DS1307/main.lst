CCS PCH C Compiler, Version 5.059, 5967               19-feb.-20 09:04

               Filename:   E:\Trabajos U\ELECTIVA INSTRUMENTACION\PROYECTO\DS1307\main.lst

               ROM used:   1840 bytes (6%)
                           Largest free fragment is 30928
               RAM used:   15 (1%) at main() level
                           24 (1%) worst case
               Stack used: 3 locations
               Stack size: 31

*
0000:  GOTO   065C
.................... #include <main.h> 
.................... #include <18F2550.h> 
.................... //////////// Standard Header file for the PIC18F2550 device //////////////// 
.................... /////////////////////////////////////////////////////////////////////////// 
.................... ////        (C) Copyright 1996, 2014 Custom Computer Services          //// 
.................... //// This source code may only be used by licensed users of the CCS C  //// 
.................... //// compiler.  This source code may only be distributed to other      //// 
.................... //// licensed users of the CCS C compiler.  No other use, reproduction //// 
.................... //// or distribution is permitted without written permission.          //// 
.................... //// Derivative programs created using this software in object code    //// 
.................... //// form are not restricted in any way.                               //// 
.................... /////////////////////////////////////////////////////////////////////////// 
.................... #device PIC18F2550 
0004:  DATA 54,49
0006:  DATA 4D,45
0008:  DATA 3A,20
000A:  DATA 25,30
000C:  DATA 32,75
000E:  DATA 3A,25
0010:  DATA 30,32
0012:  DATA 75,3A
0014:  DATA 25,30
0016:  DATA 32,75
0018:  DATA 00,00
001A:  DATA 20,44
001C:  DATA 41,54
001E:  DATA 45,3A
0020:  DATA 20,25
0022:  DATA 30,32
0024:  DATA 75,2F
0026:  DATA 25,30
0028:  DATA 32,75
002A:  DATA 2F,32
002C:  DATA 30,25
002E:  DATA 30,32
0030:  DATA 75,0D
0032:  DATA 0A,00
*
021A:  TBLRD*+
021C:  MOVFF  FF6,11
0220:  MOVFF  FF7,12
0224:  MOVFF  FF5,13
0228:  RCALL  01DC
022A:  MOVFF  11,FF6
022E:  MOVFF  12,FF7
0232:  DECFSZ 10,F
0234:  BRA    021A
0236:  RETURN 0
0238:  MOVF   16,W
023A:  CLRF   01
023C:  SUBWF  15,W
023E:  BC    0246
0240:  MOVFF  15,00
0244:  BRA    025E
0246:  CLRF   00
0248:  MOVLW  08
024A:  MOVWF  17
024C:  RLCF   15,F
024E:  RLCF   00,F
0250:  MOVF   16,W
0252:  SUBWF  00,W
0254:  BTFSC  FD8.0
0256:  MOVWF  00
0258:  RLCF   01,F
025A:  DECFSZ 17,F
025C:  BRA    024C
025E:  RETURN 0
0260:  MOVF   01,W
0262:  MOVFF  10,15
0266:  MOVLW  64
0268:  MOVWF  16
026A:  RCALL  0238
026C:  MOVFF  00,10
0270:  MOVF   01,W
0272:  MOVLW  30
0274:  BNZ   0284
0276:  BTFSS  11.1
0278:  BRA    0292
027A:  BTFSC  11.3
027C:  BRA    0292
027E:  BTFSC  11.4
0280:  MOVLW  20
0282:  BRA    028A
0284:  BCF    11.3
0286:  BCF    11.4
0288:  BSF    11.0
028A:  ADDWF  01,F
028C:  MOVFF  01,13
0290:  RCALL  01DC
0292:  MOVFF  10,15
0296:  MOVLW  0A
0298:  MOVWF  16
029A:  RCALL  0238
029C:  MOVFF  00,10
02A0:  MOVF   01,W
02A2:  MOVLW  30
02A4:  BNZ   02B2
02A6:  BTFSC  11.3
02A8:  BRA    02BA
02AA:  BTFSS  11.0
02AC:  BRA    02BA
02AE:  BTFSC  11.4
02B0:  MOVLW  20
02B2:  ADDWF  01,F
02B4:  MOVFF  01,13
02B8:  RCALL  01DC
02BA:  MOVLW  30
02BC:  ADDWF  10,F
02BE:  MOVFF  10,13
02C2:  RCALL  01DC
02C4:  RETURN 0
....................  
.................... #list 
....................  
.................... #use delay(internal=8MHz) 
*
0034:  CLRF   FEA
0036:  MOVLW  0E
0038:  MOVWF  FE9
003A:  MOVF   FEF,W
003C:  BZ    0058
003E:  MOVLW  02
0040:  MOVWF  01
0042:  CLRF   00
0044:  DECFSZ 00,F
0046:  BRA    0044
0048:  DECFSZ 01,F
004A:  BRA    0042
004C:  MOVLW  97
004E:  MOVWF  00
0050:  DECFSZ 00,F
0052:  BRA    0050
0054:  DECFSZ FEF,F
0056:  BRA    003E
0058:  RETURN 0
.................... #use i2c(Master,Fast=4000000,sda=PIN_A1,scl=PIN_A0) 
005A:  MOVLW  08
005C:  MOVWF  01
005E:  NOP   
0060:  BCF    F89.0
0062:  BCF    F92.0
0064:  NOP   
0066:  RLCF   12,F
0068:  BCF    F89.1
006A:  BTFSC  FD8.0
006C:  BSF    F92.1
006E:  BTFSS  FD8.0
0070:  BCF    F92.1
0072:  BSF    F92.0
0074:  BTFSS  F80.0
0076:  BRA    0074
0078:  DECFSZ 01,F
007A:  BRA    005E
007C:  NOP   
007E:  BCF    F89.0
0080:  BCF    F92.0
0082:  NOP   
0084:  BSF    F92.1
0086:  NOP   
0088:  NOP   
008A:  BSF    F92.0
008C:  BTFSS  F80.0
008E:  BRA    008C
0090:  CLRF   01
0092:  NOP   
0094:  BTFSC  F80.1
0096:  BSF    01.0
0098:  BCF    F89.0
009A:  BCF    F92.0
009C:  BCF    F89.1
009E:  BCF    F92.1
00A0:  RETURN 0
00A2:  MOVLW  08
00A4:  MOVWF  13
00A6:  MOVFF  00,14
00AA:  BSF    F92.1
00AC:  NOP   
00AE:  BSF    F92.0
00B0:  BTFSS  F80.0
00B2:  BRA    00B0
00B4:  BTFSC  F80.1
00B6:  BSF    FD8.0
00B8:  BTFSS  F80.1
00BA:  BCF    FD8.0
00BC:  RLCF   01,F
00BE:  NOP   
00C0:  BCF    F92.0
00C2:  BCF    F89.0
00C4:  DECFSZ 13,F
00C6:  BRA    00AA
00C8:  BSF    F92.1
00CA:  NOP   
00CC:  BCF    F89.1
00CE:  MOVF   14,W
00D0:  BTFSS  FD8.2
00D2:  BCF    F92.1
00D4:  NOP   
00D6:  BSF    F92.0
00D8:  BTFSS  F80.0
00DA:  BRA    00D8
00DC:  NOP   
00DE:  BCF    F89.0
00E0:  BCF    F92.0
00E2:  NOP   
00E4:  BCF    F89.1
00E6:  BCF    F92.1
00E8:  RETURN 0
.................... #use rs232(baud=115200,parity=N,xmit=PIN_A3,rcv=PIN_A4,stream=asd) 
*
01DC:  BCF    F92.3
01DE:  BCF    F89.3
01E0:  MOVLW  08
01E2:  MOVWF  01
01E4:  BRA    01E6
01E6:  NOP   
01E8:  BSF    01.7
01EA:  BRA    0210
01EC:  BCF    01.7
01EE:  MOVFF  13,02
01F2:  RRCF   02,F
01F4:  BTFSC  FD8.0
01F6:  BSF    F89.3
01F8:  BTFSS  FD8.0
01FA:  BCF    F89.3
01FC:  BSF    01.6
01FE:  BRA    0210
0200:  BCF    01.6
0202:  DECFSZ 01,F
0204:  BRA    01F2
0206:  MOVFF  02,13
020A:  BRA    020C
020C:  NOP   
020E:  BSF    F89.3
0210:  BTFSC  01.7
0212:  BRA    01EC
0214:  BTFSC  01.6
0216:  BRA    0200
0218:  RETURN 0
.................... #define DS1307_I2C_NO_STREAM 
....................  
.................... #include <DS1307.c> 
.................... /////////////////////////////////////////////////////////////////////////// 
.................... ////                                                                   //// 
.................... ////                             DS1307.c                              //// 
.................... ////                                                                   //// 
.................... ////                      Driver for CCS C compiler                    //// 
.................... ////                                                                   //// 
.................... ////     Driver for Maxim DS1307 serial I2C real-time clock (RTC).     //// 
.................... ////                                                                   //// 
.................... /////////////////////////////////////////////////////////////////////////// 
.................... ////                                                                   //// 
.................... ////                     https://simple-circuit.com/                   //// 
.................... ////                                                                   //// 
.................... /////////////////////////////////////////////////////////////////////////// 
....................  
....................  
.................... #if defined DS1307_I2C_NO_STREAM 
....................   #define RTC_I2C_START()   i2c_start() 
....................   #define RTC_I2C_STOP()    i2c_stop() 
....................   #define RTC_I2C_WRITE(x)  i2c_write(x) 
....................   #define RTC_I2C_READ(x)   i2c_read(x) 
.................... #elif defined DS1307_I2C_STREAM 
....................   #define RTC_I2C_START()   i2c_start(DS1307_I2C_STREAM) 
....................   #define RTC_I2C_STOP()    i2c_stop(DS1307_I2C_STREAM) 
....................   #define RTC_I2C_WRITE(x)  i2c_write(DS1307_I2C_STREAM, x) 
....................   #define RTC_I2C_READ(x)   i2c_read(DS1307_I2C_STREAM, x) 
.................... #else 
....................   #define RTC_I2C_START()   i2c_start(DS1307_STREAM) 
....................   #define RTC_I2C_STOP()    i2c_stop(DS1307_STREAM) 
....................   #define RTC_I2C_WRITE(x)  i2c_write(DS1307_STREAM, x) 
....................   #define RTC_I2C_READ(x)   i2c_read(DS1307_STREAM, x) 
.................... #endif 
....................  
.................... #include <stdint.h> 
.................... /////////////////////////////////////////////////////////////////////////// 
.................... ////                                                                   //// 
.................... ////                           stdint.h                                //// 
.................... ////                                                                   //// 
.................... //// Standard integer definitions.                                     //// 
.................... ////                                                                   //// 
.................... /////////////////////////////////////////////////////////////////////////// 
.................... ////        (C) Copyright 1996,2008 Custom Computer Services           //// 
.................... //// This source code may only be used by licensed users of the CCS C  //// 
.................... //// compiler.  This source code may only be distributed to other      //// 
.................... //// licensed users of the CCS C compiler.  No other use, reproduction //// 
.................... //// or distribution is permitted without written permission.          //// 
.................... //// Derivative programs created using this software in object code    //// 
.................... //// form are not restricted in any way.                               //// 
.................... /////////////////////////////////////////////////////////////////////////// 
....................  
.................... #ifndef _STDINT 
....................  
.................... #define _STDINT 
....................  
.................... //////////// exact width 
....................  
.................... typedef signed int8 int8_t; 
.................... typedef unsigned int8 uint8_t; 
.................... typedef signed int16 int16_t; 
.................... typedef unsigned int16 uint16_t; 
.................... typedef signed int32 int32_t; 
.................... typedef unsigned int32 uint32_t; 
....................  
.................... #if defined(__PCD__) 
.................... //typedef signed int24 int24_t; 
.................... //typedef unsigned int24 uint24_t; 
.................... typedef signed int64 int64_t; 
.................... typedef unsigned int64 uint64_t; 
.................... #endif 
....................  
.................... #define INT8_MAX  (127) 
.................... #define INT8_MIN  (-128) 
.................... #define UINT8_MAX (255) 
....................  
.................... #define INT16_MAX  (32767) 
.................... #define INT16_MIN  (-32768) 
.................... #define UINT16_MAX (65535) 
....................  
.................... #define INT32_MAX  (2147483647) 
.................... #define INT32_MIN  (-2147483648) 
.................... #define UINT32_MAX (4294967295) 
....................  
.................... #if defined(__PCD__) 
.................... //#define INT24_MAX  (8388607) 
.................... //#define INT24_MIN  (-8388608) 
.................... //#define UINT24_MAX (16777215) 
....................  
.................... #define INT64_MAX  (9223372036854775807) 
.................... #define INT64_MIN  (-9223372036854775808) 
.................... #define UINT64_MAX (18446744073709551615) 
.................... #endif 
....................  
.................... ///////// minimum width 
....................  
.................... typedef signed int8 int_least8_t; 
.................... typedef unsigned int8 uint_least8_t; 
.................... typedef signed int16 int_least16_t; 
.................... typedef unsigned int16 uint_least16_t; 
.................... typedef signed int32 int_least32_t; 
.................... typedef unsigned int32 uint_least32_t; 
....................  
.................... #if defined(__PCD__) 
.................... //typedef signed int24 int_least24_t; 
.................... //typedef unsigned int24 uint_least24_t; 
.................... typedef signed int64 int_least64_t; 
.................... typedef unsigned int64 uint_least64_t; 
.................... #endif 
....................  
.................... #define INT_LEAST8_MAX  (127) 
.................... #define INT_LEAST8_MIN  (-128) 
.................... #define UINT_LEAST8_MAX (255) 
....................  
.................... #define INT_LEAST16_MAX  (32767) 
.................... #define INT_LEAST16_MIN  (-32768) 
.................... #define UINT_LEAST16_MAX (65535) 
....................  
.................... #define INT_LEAST32_MAX  (2147483647) 
.................... #define INT_LEAST32_MIN  (-2147483648) 
.................... #define UINT_LEAST32_MAX (4294967295) 
....................  
.................... #if defined(__PCD__) 
.................... //#define INT_LEAST24_MAX  (8388607) 
.................... //#define INT_LEAST24_MIN  (-8388608) 
.................... //#define UINT_LEAST24_MAX (16777215) 
....................  
.................... #define INT_LEAST64_MAX  (9223372036854775807) 
.................... #define INT_LEAST64_MIN  (-9223372036854775808) 
.................... #define UINT_LEAST64_MAX (18446744073709551615) 
.................... #endif 
....................  
.................... ///////// fastest width 
....................  
.................... #if defined(__PCD__) 
.................... typedef signed int16 int_fast8_t; 
.................... typedef unsigned int16 uint_fast8_t; 
.................... #define INT_FAST8_MAX  (32767) 
.................... #define INT_FAST8_MIN  (-32768) 
.................... #define UINT_FAST8_MAX (65535) 
.................... typedef signed int16 int_fast16_t; 
.................... typedef unsigned int16 uint_fast16_t; 
.................... //typedef signed int24 int_fast24_t; 
.................... //typedef unsigned int24 uint_fast24_t; 
.................... typedef signed int64 int_fast64_t; 
.................... typedef unsigned int64 uint_fast64_t; 
.................... #else 
.................... typedef signed int8 int_fast8_t; 
.................... typedef unsigned int8 uint_fast8_t; 
.................... #define INT_FAST8_MAX  (127) 
.................... #define INT_FAST8_MIN  (-128) 
.................... #define UINT_FAST8_MAX (255) 
.................... typedef signed int16 int_fast16_t; 
.................... typedef unsigned int16 uint_fast16_t; 
.................... #endif 
....................  
.................... typedef signed int32 int_fast32_t; 
.................... typedef unsigned int32 uint_fast32_t; 
....................  
.................... #define INT_FAST16_MAX  (32767) 
.................... #define INT_FAST16_MIN  (-32768) 
.................... #define UINT_FAST16_MAX (65535) 
....................  
.................... #define INT_FAST32_MAX  (2147483647) 
.................... #define INT_FAST32_MIN  (-2147483648) 
.................... #define UINT_FAST32_MAX (4294967295) 
....................  
.................... #if defined(__PCD__) 
.................... //#define INT_FAST24_MAX  (8388607) 
.................... //#define INT_FAST24_MIN  (-8388608) 
.................... //#define UINT_FAST24_MAX (16777215) 
....................  
.................... #define INT_FAST64_MAX  (9223372036854775807) 
.................... #define INT_FAST64_MIN  (-9223372036854775808) 
.................... #define UINT_FAST64_MAX (18446744073709551615) 
.................... #endif 
....................  
.................... //////////// big enough to hold pointers (OPTIONAL) 
....................  
.................... #if defined(__PCD__) 
....................    typedef unsigned int32 uintptr_t; 
....................    typedef signed int32 intptr_t; 
.................... #else 
....................    typedef unsigned int16 uintptr_t; 
....................    typedef signed int16 intptr_t; 
.................... #endif 
....................  
.................... /// TODO: 
.................... /// INTPTRN_MIN INTPTRN_MAX UINTPTRN_MAX 
....................  
....................  
.................... /////////// greatest width (OPTIONAL) 
....................  
.................... /// TODO 
....................  
.................... /// intmax_t uintmax_t 
....................  
.................... /// INTMAXN_MIN INTMAXN_MAX UINTMAXN_MAX 
....................  
.................... /// INTMAX_C(value) UINTMAX_C(value) 
....................  
....................  
.................... #endif 
....................  
....................  
.................... #define DS1307_ADDRESS      0xD0 
.................... #define DS1307_REG_SECONDS  0x00 
.................... #define DS1307_REG_CONTROL  0x07 
....................  
....................  
.................... enum SQWE 
.................... { 
....................   OUT_OFF = 0x00, 
....................   OUT_ON  = 0x80, 
....................   OUT_1Hz = 0x10, 
....................   OUT_4096Hz  = 0x11, 
....................   OUT_8192Hz  = 0x12, 
....................   OUT_32768Hz = 0x13 
.................... }; 
....................  
.................... typedef enum 
.................... { 
....................   SUNDAY = 1, 
....................   MONDAY, 
....................   TUESDAY, 
....................   WEDNESDAY, 
....................   THURSDAY, 
....................   FRIDAY, 
....................   SATURDAY 
.................... } RTC_DOW; 
....................  
.................... typedef enum 
.................... { 
....................   JANUARY = 1, 
....................   FEBRUARY, 
....................   MARCH, 
....................   APRIL, 
....................   MAY, 
....................   JUNE, 
....................   JULY, 
....................   AUGUST, 
....................   SEPTEMBER, 
....................   OCTOBER, 
....................   NOVEMBER, 
....................   DECEMBER 
.................... } RTC_Month; 
....................  
.................... typedef struct rtc_tm 
.................... { 
....................   uint8_t seconds; 
....................   uint8_t minutes; 
....................   uint8_t hours; 
....................   RTC_DOW dow; 
....................   uint8_t day; 
....................   RTC_Month month; 
....................   uint8_t year; 
.................... } RTC_Time; 
....................  
.................... ///////////////////////// All Functions ///////////////////////// 
....................                                                                // 
.................... uint8_t bcd_to_decimal(uint8_t number);                        // 
.................... uint8_t decimal_to_bcd(uint8_t number);                        // 
.................... void RTC_Set(RTC_Time *time_t);                                // 
.................... RTC_Time *RTC_Get();                                           // 
.................... void OSC_Enable();                                             // 
.................... void OSC_Disable();                                            // 
.................... uint8_t RTC_Read_Reg(uint8_t reg_address);                     // 
.................... void RTC_Write_Reg(uint8_t reg_address, uint8_t reg_value);    // 
.................... void SQWE_Set(SQWE pin_out);                                   // 
....................                                                                // 
.................... ///////////////////////////////////////////////////////////////// 
....................  
.................... // converts BCD to decimal 
.................... uint8_t bcd_to_decimal(uint8_t number) 
.................... { 
....................   return ( (number >> 4) * 10 + (number & 0x0F) ); 
*
00EA:  SWAPF  0D,W
00EC:  MOVWF  00
00EE:  MOVLW  0F
00F0:  ANDWF  00,F
00F2:  MOVF   00,W
00F4:  MULLW  0A
00F6:  MOVFF  FF3,0E
00FA:  MOVF   0D,W
00FC:  ANDLW  0F
00FE:  ADDWF  0E,W
0100:  MOVWF  01
0102:  RETURN 0
.................... } 
....................  
.................... // converts decimal to BCD 
.................... uint8_t decimal_to_bcd(uint8_t number) 
.................... { 
....................   return ( ((number / 10) << 4) + (number % 10) ); 
*
0404:  MOVFF  13,15
0408:  MOVLW  0A
040A:  MOVWF  16
040C:  RCALL  0238
040E:  SWAPF  01,W
0410:  MOVWF  14
0412:  MOVLW  F0
0414:  ANDWF  14,F
0416:  MOVFF  13,15
041A:  MOVLW  0A
041C:  MOVWF  16
041E:  RCALL  0238
0420:  MOVF   00,W
0422:  ADDWF  14,W
0424:  MOVWF  01
0426:  RETURN 0
.................... } 
....................  
.................... // sets time and date 
.................... void RTC_Set(RTC_Time *time_t) 
0428:  CLRF   10
042A:  RCALL  03A8
042C:  MOVFF  01,0F
.................... { 
....................   uint8_t sec_reg = RTC_Read_Reg(DS1307_REG_SECONDS); 
....................  
....................   // convert decimal to BCD 
....................   time_t->day     = decimal_to_bcd(time_t->day); 
0430:  MOVLW  04
0432:  ADDWF  0D,W
0434:  MOVWF  01
0436:  MOVLW  00
0438:  ADDWFC 0E,W
043A:  MOVWF  03
043C:  MOVFF  01,10
0440:  MOVWF  11
0442:  MOVLW  04
0444:  ADDWF  0D,W
0446:  MOVWF  FE9
0448:  MOVLW  00
044A:  ADDWFC 0E,W
044C:  MOVWF  FEA
044E:  MOVFF  FEF,13
0452:  RCALL  0404
0454:  MOVFF  11,FEA
0458:  MOVFF  10,FE9
045C:  MOVFF  01,FEF
....................   time_t->month   = decimal_to_bcd(time_t->month); 
0460:  MOVLW  05
0462:  ADDWF  0D,W
0464:  MOVWF  01
0466:  MOVLW  00
0468:  ADDWFC 0E,W
046A:  MOVWF  03
046C:  MOVFF  01,10
0470:  MOVWF  11
0472:  MOVLW  05
0474:  ADDWF  0D,W
0476:  MOVWF  FE9
0478:  MOVLW  00
047A:  ADDWFC 0E,W
047C:  MOVWF  FEA
047E:  MOVFF  FEF,13
0482:  RCALL  0404
0484:  MOVFF  11,FEA
0488:  MOVFF  10,FE9
048C:  MOVFF  01,FEF
....................   time_t->year    = decimal_to_bcd(time_t->year); 
0490:  MOVLW  06
0492:  ADDWF  0D,W
0494:  MOVWF  01
0496:  MOVLW  00
0498:  ADDWFC 0E,W
049A:  MOVWF  03
049C:  MOVFF  01,10
04A0:  MOVWF  11
04A2:  MOVLW  06
04A4:  ADDWF  0D,W
04A6:  MOVWF  FE9
04A8:  MOVLW  00
04AA:  ADDWFC 0E,W
04AC:  MOVWF  FEA
04AE:  MOVFF  FEF,13
04B2:  RCALL  0404
04B4:  MOVFF  11,FEA
04B8:  MOVFF  10,FE9
04BC:  MOVFF  01,FEF
....................   time_t->hours   = decimal_to_bcd(time_t->hours); 
04C0:  MOVLW  02
04C2:  ADDWF  0D,W
04C4:  MOVWF  01
04C6:  MOVLW  00
04C8:  ADDWFC 0E,W
04CA:  MOVWF  03
04CC:  MOVFF  01,10
04D0:  MOVWF  11
04D2:  MOVLW  02
04D4:  ADDWF  0D,W
04D6:  MOVWF  FE9
04D8:  MOVLW  00
04DA:  ADDWFC 0E,W
04DC:  MOVWF  FEA
04DE:  MOVFF  FEF,13
04E2:  RCALL  0404
04E4:  MOVFF  11,FEA
04E8:  MOVFF  10,FE9
04EC:  MOVFF  01,FEF
....................   time_t->minutes = decimal_to_bcd(time_t->minutes); 
04F0:  MOVLW  01
04F2:  ADDWF  0D,W
04F4:  MOVWF  01
04F6:  MOVLW  00
04F8:  ADDWFC 0E,W
04FA:  MOVWF  03
04FC:  MOVFF  01,10
0500:  MOVWF  11
0502:  MOVLW  01
0504:  ADDWF  0D,W
0506:  MOVWF  FE9
0508:  MOVLW  00
050A:  ADDWFC 0E,W
050C:  MOVWF  FEA
050E:  MOVFF  FEF,13
0512:  RCALL  0404
0514:  MOVFF  11,FEA
0518:  MOVFF  10,FE9
051C:  MOVFF  01,FEF
....................   time_t->seconds = decimal_to_bcd(time_t->seconds); 
0520:  MOVFF  0D,01
0524:  MOVFF  0E,03
0528:  MOVFF  0D,10
052C:  MOVFF  0E,11
0530:  MOVFF  0D,FE9
0534:  MOVFF  0E,FEA
0538:  MOVFF  FEF,13
053C:  RCALL  0404
053E:  MOVFF  11,FEA
0542:  MOVFF  10,FE9
0546:  MOVFF  01,FEF
....................   // end conversion 
....................    
....................   // test if oscillator is disabled (CH bit = 1) 
....................   if(sec_reg & 0x80) 
054A:  BTFSS  0F.7
054C:  BRA    055C
....................     time_t->seconds |= 0x80; 
054E:  MOVFF  0D,FE9
0552:  MOVFF  0E,FEA
0556:  MOVF   FEF,W
0558:  IORLW  80
055A:  MOVWF  FEF
....................  
....................   // write data to the RTC chip 
....................   RTC_I2C_START(); 
055C:  BSF    F92.1
055E:  NOP   
0560:  BSF    F92.0
0562:  NOP   
0564:  BCF    F89.1
0566:  BCF    F92.1
0568:  NOP   
056A:  BCF    F89.0
056C:  BCF    F92.0
....................   RTC_I2C_WRITE(DS1307_ADDRESS); 
056E:  MOVLW  D0
0570:  MOVWF  12
0572:  RCALL  005A
....................   RTC_I2C_WRITE(DS1307_REG_SECONDS); 
0574:  CLRF   12
0576:  RCALL  005A
....................   RTC_I2C_WRITE(time_t->seconds); 
0578:  MOVFF  0D,FE9
057C:  MOVFF  0E,FEA
0580:  MOVFF  FEF,12
0584:  RCALL  005A
....................   RTC_I2C_WRITE(time_t->minutes); 
0586:  MOVLW  01
0588:  ADDWF  0D,W
058A:  MOVWF  FE9
058C:  MOVLW  00
058E:  ADDWFC 0E,W
0590:  MOVWF  FEA
0592:  MOVFF  FEF,12
0596:  RCALL  005A
....................   RTC_I2C_WRITE(time_t->hours); 
0598:  MOVLW  02
059A:  ADDWF  0D,W
059C:  MOVWF  FE9
059E:  MOVLW  00
05A0:  ADDWFC 0E,W
05A2:  MOVWF  FEA
05A4:  MOVFF  FEF,12
05A8:  RCALL  005A
....................   RTC_I2C_WRITE(time_t->dow); 
05AA:  MOVLW  03
05AC:  ADDWF  0D,W
05AE:  MOVWF  FE9
05B0:  MOVLW  00
05B2:  ADDWFC 0E,W
05B4:  MOVWF  FEA
05B6:  MOVFF  FEF,12
05BA:  RCALL  005A
....................   RTC_I2C_WRITE(time_t->day); 
05BC:  MOVLW  04
05BE:  ADDWF  0D,W
05C0:  MOVWF  FE9
05C2:  MOVLW  00
05C4:  ADDWFC 0E,W
05C6:  MOVWF  FEA
05C8:  MOVFF  FEF,12
05CC:  RCALL  005A
....................   RTC_I2C_WRITE(time_t->month); 
05CE:  MOVLW  05
05D0:  ADDWF  0D,W
05D2:  MOVWF  FE9
05D4:  MOVLW  00
05D6:  ADDWFC 0E,W
05D8:  MOVWF  FEA
05DA:  MOVFF  FEF,12
05DE:  RCALL  005A
....................   RTC_I2C_WRITE(time_t->year); 
05E0:  MOVLW  06
05E2:  ADDWF  0D,W
05E4:  MOVWF  FE9
05E6:  MOVLW  00
05E8:  ADDWFC 0E,W
05EA:  MOVWF  FEA
05EC:  MOVFF  FEF,12
05F0:  RCALL  005A
....................   RTC_I2C_STOP(); 
05F2:  BCF    F92.1
05F4:  NOP   
05F6:  BSF    F92.0
05F8:  BTFSS  F80.0
05FA:  BRA    05F8
05FC:  NOP   
05FE:  BRA    0600
0600:  NOP   
0602:  BSF    F92.1
0604:  NOP   
0606:  GOTO   0710 (RETURN)
.................... } 
....................  
.................... RTC_Time c_time; 
....................  
.................... // reads time and date 
.................... RTC_Time *RTC_Get() 
.................... { 
....................   RTC_I2C_START(); 
*
0104:  BSF    F92.1
0106:  NOP   
0108:  BSF    F92.0
010A:  NOP   
010C:  BCF    F89.1
010E:  BCF    F92.1
0110:  NOP   
0112:  BCF    F89.0
0114:  BCF    F92.0
....................   RTC_I2C_WRITE(DS1307_ADDRESS); 
0116:  MOVLW  D0
0118:  MOVWF  12
011A:  RCALL  005A
....................   RTC_I2C_WRITE(DS1307_REG_SECONDS); 
011C:  CLRF   12
011E:  RCALL  005A
....................   RTC_I2C_START(); 
0120:  BSF    F92.1
0122:  NOP   
0124:  BSF    F92.0
0126:  NOP   
0128:  BTFSS  F80.0
012A:  BRA    0128
012C:  BCF    F89.1
012E:  BCF    F92.1
0130:  NOP   
0132:  BCF    F89.0
0134:  BCF    F92.0
....................   RTC_I2C_WRITE(DS1307_ADDRESS | 0x01); 
0136:  MOVLW  D1
0138:  MOVWF  12
013A:  RCALL  005A
....................   c_time.seconds = RTC_I2C_READ(1) & 0x7F; 
013C:  MOVLW  01
013E:  MOVWF  00
0140:  RCALL  00A2
0142:  MOVF   01,W
0144:  ANDLW  7F
0146:  MOVWF  04
....................   c_time.minutes = RTC_I2C_READ(1); 
0148:  MOVLW  01
014A:  MOVWF  00
014C:  RCALL  00A2
014E:  MOVFF  01,05
....................   c_time.hours   = RTC_I2C_READ(1); 
0152:  MOVLW  01
0154:  MOVWF  00
0156:  RCALL  00A2
0158:  MOVFF  01,06
....................   c_time.dow   = RTC_I2C_READ(1); 
015C:  MOVLW  01
015E:  MOVWF  00
0160:  RCALL  00A2
0162:  MOVFF  01,07
....................   c_time.day   = RTC_I2C_READ(1); 
0166:  MOVLW  01
0168:  MOVWF  00
016A:  RCALL  00A2
016C:  MOVFF  01,08
....................   c_time.month = RTC_I2C_READ(1); 
0170:  MOVLW  01
0172:  MOVWF  00
0174:  RCALL  00A2
0176:  MOVFF  01,09
....................   c_time.year  = RTC_I2C_READ(0); 
017A:  CLRF   00
017C:  RCALL  00A2
017E:  MOVFF  01,0A
....................   RTC_I2C_STOP(); 
0182:  BCF    F92.1
0184:  NOP   
0186:  BSF    F92.0
0188:  BTFSS  F80.0
018A:  BRA    0188
018C:  NOP   
018E:  BRA    0190
0190:  NOP   
0192:  BSF    F92.1
0194:  NOP   
....................  
....................   // convert BCD to decimal 
....................   c_time.seconds = bcd_to_decimal(c_time.seconds); 
0196:  MOVFF  04,0D
019A:  RCALL  00EA
019C:  MOVFF  01,04
....................   c_time.minutes = bcd_to_decimal(c_time.minutes); 
01A0:  MOVFF  05,0D
01A4:  RCALL  00EA
01A6:  MOVFF  01,05
....................   c_time.hours   = bcd_to_decimal(c_time.hours); 
01AA:  MOVFF  06,0D
01AE:  RCALL  00EA
01B0:  MOVFF  01,06
....................   c_time.day     = bcd_to_decimal(c_time.day); 
01B4:  MOVFF  08,0D
01B8:  RCALL  00EA
01BA:  MOVFF  01,08
....................   c_time.month   = bcd_to_decimal(c_time.month); 
01BE:  MOVFF  09,0D
01C2:  RCALL  00EA
01C4:  MOVFF  01,09
....................   c_time.year    = bcd_to_decimal(c_time.year); 
01C8:  MOVFF  0A,0D
01CC:  RCALL  00EA
01CE:  MOVFF  01,0A
....................   // end conversion 
....................  
....................   return &c_time; 
01D2:  MOVLW  04
01D4:  MOVWF  01
01D6:  MOVLW  00
01D8:  MOVWF  02
01DA:  RETURN 0
.................... } 
....................  
.................... // writes 'reg_value' to register of address 'reg_address' 
.................... void RTC_Write_Reg(uint8_t reg_address, uint8_t reg_value) 
.................... { 
....................   RTC_I2C_START(); 
*
060A:  BSF    F92.1
060C:  NOP   
060E:  BSF    F92.0
0610:  NOP   
0612:  BCF    F89.1
0614:  BCF    F92.1
0616:  NOP   
0618:  BCF    F89.0
061A:  BCF    F92.0
....................   RTC_I2C_WRITE(DS1307_ADDRESS); 
061C:  MOVLW  D0
061E:  MOVWF  12
0620:  RCALL  005A
....................   RTC_I2C_WRITE(reg_address); 
0622:  MOVFF  0E,12
0626:  RCALL  005A
....................   RTC_I2C_WRITE(reg_value); 
0628:  MOVFF  0F,12
062C:  RCALL  005A
....................   RTC_I2C_STOP(); 
062E:  BCF    F92.1
0630:  NOP   
0632:  BSF    F92.0
0634:  BTFSS  F80.0
0636:  BRA    0634
0638:  NOP   
063A:  BRA    063C
063C:  NOP   
063E:  BSF    F92.1
0640:  NOP   
0642:  GOTO   0658 (RETURN)
.................... } 
....................  
.................... // returns the value stored in register of address 'reg_address' 
.................... uint8_t RTC_Read_Reg(uint8_t reg_address) 
.................... { 
....................   uint8_t reg_data; 
....................  
....................   RTC_I2C_START(); 
*
03A8:  BSF    F92.1
03AA:  NOP   
03AC:  BSF    F92.0
03AE:  NOP   
03B0:  BCF    F89.1
03B2:  BCF    F92.1
03B4:  NOP   
03B6:  BCF    F89.0
03B8:  BCF    F92.0
....................   RTC_I2C_WRITE(DS1307_ADDRESS); 
03BA:  MOVLW  D0
03BC:  MOVWF  12
03BE:  RCALL  005A
....................   RTC_I2C_WRITE(reg_address); 
03C0:  MOVFF  10,12
03C4:  RCALL  005A
....................   RTC_I2C_START(); 
03C6:  BSF    F92.1
03C8:  NOP   
03CA:  BSF    F92.0
03CC:  NOP   
03CE:  BTFSS  F80.0
03D0:  BRA    03CE
03D2:  BCF    F89.1
03D4:  BCF    F92.1
03D6:  NOP   
03D8:  BCF    F89.0
03DA:  BCF    F92.0
....................   RTC_I2C_WRITE(DS1307_ADDRESS | 0x01); 
03DC:  MOVLW  D1
03DE:  MOVWF  12
03E0:  RCALL  005A
....................   reg_data = RTC_I2C_READ(0); 
03E2:  CLRF   00
03E4:  RCALL  00A2
03E6:  MOVFF  01,11
....................   RTC_I2C_STOP(); 
03EA:  BCF    F92.1
03EC:  NOP   
03EE:  BSF    F92.0
03F0:  BTFSS  F80.0
03F2:  BRA    03F0
03F4:  NOP   
03F6:  BRA    03F8
03F8:  NOP   
03FA:  BSF    F92.1
03FC:  NOP   
....................  
....................   return reg_data; 
03FE:  MOVFF  11,01
0402:  RETURN 0
.................... } 
....................  
.................... // sets SQWE pin output 
.................... void SQWE_Set(SQWE pin_out) 
.................... { 
....................   RTC_I2C_START(); 
....................   RTC_I2C_WRITE(DS1307_ADDRESS); 
....................   RTC_I2C_WRITE(DS1307_REG_CONTROL); 
....................   RTC_I2C_WRITE(pin_out); 
....................   RTC_I2C_STOP(); 
.................... } 
....................  
.................... // enables RTC oscillator 
.................... void OSC_Enable() 
.................... { 
....................   uint8_t sec_reg = RTC_Read_Reg(DS1307_REG_SECONDS); 
....................   sec_reg &= 0x7F; 
....................   RTC_Write_Reg(DS1307_REG_SECONDS, sec_reg); 
.................... } 
....................  
.................... // disables RTC oscillator 
.................... void OSC_Disable() 
*
0646:  CLRF   10
0648:  RCALL  03A8
064A:  MOVFF  01,0D
.................... { 
....................   uint8_t sec_reg = RTC_Read_Reg(DS1307_REG_SECONDS); 
....................   sec_reg |= 0x80; 
064E:  BSF    0D.7
....................   RTC_Write_Reg(DS1307_REG_SECONDS, sec_reg); 
0650:  CLRF   0E
0652:  MOVFF  0D,0F
0656:  BRA    060A
0658:  GOTO   0712 (RETURN)
.................... } 
....................  
....................  
....................  
....................  
.................... // DS1307 library variable declaration 
.................... RTC_Time *mytime; 
....................  
.................... void rtc_print(){ 
....................   printf("TIME: %02u:%02u:%02u", mytime->hours, mytime->minutes, mytime->seconds); 
*
02C6:  MOVLW  02
02C8:  ADDWF  0B,W
02CA:  MOVWF  FE9
02CC:  MOVLW  00
02CE:  ADDWFC 0C,W
02D0:  MOVWF  FEA
02D2:  MOVFF  FEF,0D
02D6:  MOVLW  01
02D8:  ADDWF  0B,W
02DA:  MOVWF  FE9
02DC:  MOVLW  00
02DE:  ADDWFC 0C,W
02E0:  MOVWF  FEA
02E2:  MOVFF  FEF,0E
02E6:  MOVFF  0B,FE9
02EA:  MOVFF  0C,FEA
02EE:  MOVFF  FEF,0F
02F2:  MOVLW  04
02F4:  MOVWF  FF6
02F6:  MOVLW  00
02F8:  MOVWF  FF7
02FA:  MOVLW  06
02FC:  MOVWF  10
02FE:  RCALL  021A
0300:  MOVFF  0D,10
0304:  MOVLW  01
0306:  MOVWF  11
0308:  RCALL  0260
030A:  MOVLW  3A
030C:  MOVWF  13
030E:  RCALL  01DC
0310:  MOVFF  0E,10
0314:  MOVLW  01
0316:  MOVWF  11
0318:  RCALL  0260
031A:  MOVLW  3A
031C:  MOVWF  13
031E:  RCALL  01DC
0320:  MOVFF  0F,10
0324:  MOVLW  01
0326:  MOVWF  11
0328:  RCALL  0260
....................   printf(" DATE: %02u/%02u/20%02u\r\n", mytime->day, mytime->month, mytime->year); 
032A:  MOVLW  04
032C:  ADDWF  0B,W
032E:  MOVWF  FE9
0330:  MOVLW  00
0332:  ADDWFC 0C,W
0334:  MOVWF  FEA
0336:  MOVFF  FEF,0D
033A:  MOVLW  05
033C:  ADDWF  0B,W
033E:  MOVWF  FE9
0340:  MOVLW  00
0342:  ADDWFC 0C,W
0344:  MOVWF  FEA
0346:  MOVFF  FEF,0E
034A:  MOVLW  06
034C:  ADDWF  0B,W
034E:  MOVWF  FE9
0350:  MOVLW  00
0352:  ADDWFC 0C,W
0354:  MOVWF  FEA
0356:  MOVFF  FEF,0F
035A:  MOVLW  1A
035C:  MOVWF  FF6
035E:  MOVLW  00
0360:  MOVWF  FF7
0362:  MOVLW  07
0364:  MOVWF  10
0366:  RCALL  021A
0368:  MOVFF  0D,10
036C:  MOVLW  01
036E:  MOVWF  11
0370:  RCALL  0260
0372:  MOVLW  2F
0374:  MOVWF  13
0376:  RCALL  01DC
0378:  MOVFF  0E,10
037C:  MOVLW  01
037E:  MOVWF  11
0380:  RCALL  0260
0382:  MOVLW  2A
0384:  MOVWF  FF6
0386:  MOVLW  00
0388:  MOVWF  FF7
038A:  MOVLW  03
038C:  MOVWF  10
038E:  RCALL  021A
0390:  MOVFF  0F,10
0394:  MOVLW  01
0396:  MOVWF  11
0398:  RCALL  0260
039A:  MOVLW  0D
039C:  MOVWF  13
039E:  RCALL  01DC
03A0:  MOVLW  0A
03A2:  MOVWF  13
03A4:  RCALL  01DC
03A6:  RETURN 0
.................... } 
....................   
.................... void main(){ 
*
065C:  CLRF   FF8
065E:  BCF    FD0.7
0660:  MOVLW  70
0662:  MOVWF  FD3
0664:  MOVF   FD3,W
0666:  BCF    F92.3
0668:  BSF    F89.3
066A:  MOVF   FC1,W
066C:  ANDLW  C0
066E:  IORLW  0F
0670:  MOVWF  FC1
0672:  MOVLW  07
0674:  MOVWF  FB4
....................   delay_ms(1000);  // wait a second 
0676:  MOVLW  04
0678:  MOVWF  0D
067A:  MOVLW  FA
067C:  MOVWF  0E
067E:  RCALL  0034
0680:  DECFSZ 0D,F
0682:  BRA    067A
....................   mytime = RTC_Get(); 
0684:  RCALL  0104
0686:  MOVFF  02,0C
068A:  MOVFF  01,0B
....................   rtc_print(); 
068E:  RCALL  02C6
....................   delay_ms(1000);  // wait a second 
0690:  MOVLW  04
0692:  MOVWF  0D
0694:  MOVLW  FA
0696:  MOVWF  0E
0698:  RCALL  0034
069A:  DECFSZ 0D,F
069C:  BRA    0694
....................   
....................   mytime->hours   = 9; 
069E:  MOVLW  02
06A0:  ADDWF  0B,W
06A2:  MOVWF  FE9
06A4:  MOVLW  00
06A6:  ADDWFC 0C,W
06A8:  MOVWF  FEA
06AA:  MOVLW  09
06AC:  MOVWF  FEF
....................   mytime->minutes = 05; 
06AE:  MOVLW  01
06B0:  ADDWF  0B,W
06B2:  MOVWF  FE9
06B4:  MOVLW  00
06B6:  ADDWFC 0C,W
06B8:  MOVWF  FEA
06BA:  MOVLW  05
06BC:  MOVWF  FEF
....................   mytime->seconds = 00; 
06BE:  MOVFF  0B,FE9
06C2:  MOVFF  0C,FEA
06C6:  CLRF   FEF
....................   mytime->day   = 19; 
06C8:  MOVLW  04
06CA:  ADDWF  0B,W
06CC:  MOVWF  FE9
06CE:  MOVLW  00
06D0:  ADDWFC 0C,W
06D2:  MOVWF  FEA
06D4:  MOVLW  13
06D6:  MOVWF  FEF
....................   mytime->month = 02; 
06D8:  MOVLW  05
06DA:  ADDWF  0B,W
06DC:  MOVWF  FE9
06DE:  MOVLW  00
06E0:  ADDWFC 0C,W
06E2:  MOVWF  FEA
06E4:  MOVLW  02
06E6:  MOVWF  FEF
....................   mytime->year  = 20; 
06E8:  MOVLW  06
06EA:  ADDWF  0B,W
06EC:  MOVWF  FE9
06EE:  MOVLW  00
06F0:  ADDWFC 0C,W
06F2:  MOVWF  FEA
06F4:  MOVLW  14
06F6:  MOVWF  FEF
....................    delay_ms(1000); 
06F8:  MOVLW  04
06FA:  MOVWF  0D
06FC:  MOVLW  FA
06FE:  MOVWF  0E
0700:  RCALL  0034
0702:  DECFSZ 0D,F
0704:  BRA    06FC
....................   RTC_Set(mytime); 
0706:  MOVFF  0C,0E
070A:  MOVFF  0B,0D
070E:  BRA    0428
....................   
....................  OSC_Disable(); 
0710:  BRA    0646
....................   while(TRUE){ 
....................     mytime = RTC_Get(); 
0712:  RCALL  0104
0714:  MOVFF  02,0C
0718:  MOVFF  01,0B
....................     rtc_print(); 
071C:  RCALL  02C6
....................     delay_ms(30000);  // wait 100 ms 
071E:  MOVLW  78
0720:  MOVWF  0D
0722:  MOVLW  FA
0724:  MOVWF  0E
0726:  RCALL  0034
0728:  DECFSZ 0D,F
072A:  BRA    0722
072C:  BRA    0712
....................   } 
.................... } 
....................  
072E:  SLEEP 
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
.................... //!int hr, min, sec, hr2, min2, sec2; 
.................... //! 
.................... //!int BCDaBIN(BYTE bcd){ 
.................... //!   int varia; 
.................... //!   varia=bcd; 
.................... //!   varia>>=1; 
.................... //!   varia &= 0x78; 
.................... //!   return (varia + (varia>>2) + (bcd & 0x0f)); 
.................... //!} 
.................... //! 
.................... //!void rtc_set_time(void) { 
.................... //!   i2c_start(); //Escritura 
.................... //!   i2c_write(0xD0); //Codigo de escritura 
.................... //!   i2c_write(0x02);  
.................... //!   i2c_write(0x18); //HORAS 
.................... //!   i2c_stop(); //Finaliza comunicación 
.................... //!    
.................... //!   i2c_start(); //Escritura 
.................... //!   i2c_write(0xD0); //Codigo de escritura 
.................... //!   i2c_write(0x01);  
.................... //!   i2c_write(0x56); //MINUTOS 
.................... //!   i2c_stop(); //Finaliza comunicación 
.................... //!    
.................... //!   i2c_start(); //Escritura 
.................... //!   i2c_write(0xD0); //Codigo de escritura 
.................... //!   i2c_write(0x00);  
.................... //!   i2c_write(0x10); //SEGUNDOS 
.................... //!   i2c_stop(); //Finaliza comunicación 
.................... //!} 
.................... //! 
.................... //!void rtc_get_time(BYTE& hr, BYTE& min, BYTE& sec) { 
.................... //!   i2c_start(); //Escritura 
.................... //!   i2c_write(0xD0); //Codigo de escritura 
.................... //!   i2c_write(0x00); //Puntero de la primera dirección 
.................... //!   i2c_start(); //Lectura 
.................... //!   i2c_write(0xD1); //Codigo de lectura 
.................... //!   sec = BCDaBIN(i2c_read()&0x7f); //Lectura de los 7 bit de los segundos 
.................... //!   min = BCDaBIN(i2c_read()&0x7f); //Lectura de los 7 bit de los minutos 
.................... //!   hr = BCDaBIN(i2c_read(0)&0x3f); //Lectura de los 6 bit de las horas 
.................... //!   i2c_stop(); //Finaliza comunicación 
.................... //!} 
.................... //! 
.................... //!void main(){ 
.................... //!   rtc_set_time(); 
.................... //!   while(1){ 
.................... //!      rtc_get_time(hr,min,sec); 
.................... //!      printf("H%2u:M%2u:S%2u\r\n",hr,min,sec); 
.................... //!      delay_ms(600); 
.................... //!   } 
.................... //!} 

Configuration Fuses:
   Word  1: C827   PLL12 CPUDIV1 USBDIV INTRC_IO FCMEN IESO
   Word  2: 1E3E   PUT BROWNOUT BORV21 VREGEN NOWDT WDT32768
   Word  3: 8700   CCP2C1 PBADEN LPT1OSC MCLR
   Word  4: 0081   STVREN NOLVP NOXINST NODEBUG
   Word  5: C00F   NOPROTECT NOCPB NOCPD
   Word  6: E00F   NOWRT NOWRTC NOWRTB NOWRTD
   Word  7: 400F   NOEBTR NOEBTRB
